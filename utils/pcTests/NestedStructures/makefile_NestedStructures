BASEDIR=.
OUTDIR= $(BASEDIR)/output
CC= gcc
CPP= g++
LN= g++
AR=ar
CP=cp

-include $(EPROSIMADIR)/building/makefiles/eProsima.mk

NESTEDSTRUCTURES_CFLAGS= $(CFLAGS) -std=c++0x

NESTEDSTRUCTURES_INCLUDES= -I. -I$(FASTCDR)/include -I$(EPROSIMADIR)/code

NESTEDSTRUCTURES_LIBS= -Wl,-Bstatic -L$(BASEDIR)/lib/$(EPROSIMA_TARGET) -lNestedStructures -L$(FASTCDR)/lib/$(EPROSIMA_TARGET) -lfastcdr \
						 -Wl,-Bdynamic

NESTEDSTRUCTURES_DIRECTORIES= $(BASEDIR)/output.dir $(BASEDIR)/output/$(EPROSIMA_TARGET).dir $(BASEDIR)/bin.dir $(BASEDIR)/bin/$(EPROSIMA_TARGET).dir

all: $(NESTEDSTRUCTURES_DIRECTORIES) NestedStructuresTest

NESTEDSTRUCTURES_TARGET= $(BASEDIR)/bin/$(EPROSIMA_TARGET)/NestedStructuresTest

NESTEDSTRUCTURES_SRC_CPPFILES= NestedStructuresTest.cpp

NESTEDSTRUCTURES_OBJS = $(NESTEDSTRUCTURES_SRC_CPPFILES:%.cpp=output/$(EPROSIMA_TARGET)/%.o)

OBJS+= $(NESTEDSTRUCTURES_OBJS)

NestedStructuresTest: $(NESTEDSTRUCTURES_TARGET)

$(NESTEDSTRUCTURES_TARGET): $(NESTEDSTRUCTURES_OBJS)
	$(LN) $(LDFLAGS) -o $(NESTEDSTRUCTURES_TARGET) $(NESTEDSTRUCTURES_OBJS) $(NESTEDSTRUCTURES_LIBS)

output/$(EPROSIMA_TARGET)/%.o:%.cpp
	$(CPP) $(NESTEDSTRUCTURES_CFLAGS) $(NESTEDSTRUCTURES_INCLUDES) $< -o $@

.PHONY: NestedStructuresTest

clean:
	@rm -f $(OBJS)

%.dir : 
	@echo "Checking directory $*"
	@if [ ! -d $* ]; then \
		echo "Making directory $*"; \
		mkdir -p $* ; \
	fi;
